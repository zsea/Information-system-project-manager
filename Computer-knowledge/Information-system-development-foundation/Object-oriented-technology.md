# 面向对象技术

## 基本概念

* 对象。客观事物的抽象
* 类。对象的模板
* 抽象
* 封装
* 继承与泛化。类与类的关系
* 多态
* 接口。操作规范的说明
* 消息。对象之间的交互
* 组件。物理的组成部分
* 模式和复用

### 七大设计原则

* 单一职责。设计目的单一的类
* 里氏替换。子类可以替换父类
* 开放-封闭。对扩展开放，对修改封闭
* 依赖倒置。依赖接口而不是依赖实现；针对接口编程而不是针对实现编程
* 接口隔离。用多个专用的接口比用一个单一的总接口好。
* 组合重用。尽量使用组合，而不是使用继承关系达到重用。
* 迪米特。最少知识原则，一个对象应当对其它对象尽可能少的了解。

##  分析与设计

### 目标

* 描述用户需求
* 建立软件设计基础
* 定义可被确认的需求

### 步骤

1. 发现角色/参与者
2. 发现用例
3. 建立用例模型
4. 进行领域分析
5. 建立对象关系模型
6. 建立对象行为模型
7. 建立功能模型

```memo
整个步骤是从角色/参与者到功能。中间依次经历用例、领域、对象（关系、行为）。
```

### 面向对象设计

* 用例设计 
* 类设计
* 子系统设计

## UML

### 特征

* 可视化建模语言
* 面向对象分析与设计的标准表示
* 允许任何一种过程和方法使用
* 简单可扩展
* 强调重用（架构、框架、模式和组件）

### UML2.0的图形

* 结构图
    * 类图
    * 对象图
    * 包图
    * 组合结构图
    * 构件图
    * 部署图
    * 制品图
* 行为图
    * 用例图
    * 顺序图/序列图
    * 通信图/协作图
    * 定时图
    * 状态图
    * 活动图
    * 交互概览图

#### 类图

属于结构图，强调类与类之间的关系。示例图中猫与狗都可以泛化为动物。

泛化关系，使用实线空心箭头表示。

{% plantuml %}
Class Mammal {
    +eyeColor=int
    +getEyeColor():int
}
Class Dog {
    +barkFrequency=int
    +bark()
}
Class Cat {
    +meowFrequency=int
    +meow()
}
Mammal <|-- Dog
Mammal <|-- Cat
{% endplantuml %}

#### 对象图

描述一组对象间的关系。

```memo
课本中的对象图结构中，每个对象包含类名称，如 Triange:polvgon，Ponint1:Point，Point2:Point
```

{% plantuml %}
object Triange
object Point1
object Point2
Triange -- Point1
Triange -- Point2
{% endplantuml %}


#### 构件图

封装的类（包括类的接口和端口）与连接件构成的内部结构。

{% plantuml %}
[组件1] as component
() "接口1" as api1
() "接口2" as api2
component -- api1
component -- api2
{% endplantuml %}

#### 用例图

 描述参与者与用例之间的关系。

{% plantuml %}
:user:-- (预订)
:user:-- (取车)
:user:-- (还车)

{% endplantuml %}


#### 状态图

一个状态机。由状态、转移、活动和事件购成。

{% plantuml %}

[*] -> 注册
注册 -> 在线学习:[已缴费]
在线学习 --> 在线测试:学完所有内容
在线测试 --> 在线学习
在线测试->[*]:[合格]

{% endplantuml %}

#### 活动图

展示计算内部一步一步的控制流和数据流。

{% plantuml %}

(*)-->"购物车"
"购物车" -> "输入商品目录"
"输入商品目录"->"计算总价"
if "" then
    -->[现金] ==结账成功==
else
    -->[银行卡] "提交授权请求"
    -right->"授权结账"
    -->==结账成功==
endif
==结账成功==-->"出示小票"
-->==出示完成==
---> "小票|单据"
-->==完成购物==
==出示完成==-left->"商品装袋"
-->==完成购物==
-->(*)

{% endplantuml %}


```memo
状态图主要描述的是某一个对象的状态变化过程，以及状态变化该对象做出的反应。
活动图是执行某一用例的具体步骤流程。

以学校的学生选课系统为例：
那么学生“未登录”“已登录”“未完成选课”“已完成选课”“已选XX课”“未选XX课”等都是学生的状态。描述这些状态之间是如何转化的，就要用状态图。
而学生选课的这个动作涉及到：学生、课程、教师、学生课表等多个对象。同时这个动作也是学生选课系统的一个用例，所以要描述它就要用到活动图。

总结来说就是状态图的对象主体只有一个，而活动图在活动的过程中涉及到多个对象。

```

#### 顺序图

**对象**之间传递**消息**的时间顺序，表示用例中的行为顺序。

{% plantuml %}

actor 参与者
参与者 -> 对象1:消息1
对象1 -> 对象2:消息2
对象1 --> 参与者:消息3

{% endplantuml %}


#### 协作图

强调发送消息与参与者的**组织结构**。

![通信图](/assests/images/communication-diagram.jpg)

### 需求分析

* 用例模型
    1. 识别参与者
    2. 合并需求获得用例
    3. 细化用例描述
    4. 调整用例模型
        * 包含关系
        * 扩展关系
        * 泛化关系
* 分析模型
    1. 定义概念类
    2. 识别类之间的关系
        * 依赖关系
        * 关联关系
            * 聚合关系
            * 组合关系
        * 泛化关系
        * 实现关系
    3. 为类添加职责
    4. 建立交互图

### UML关系表示

#### 依赖关系

一个事物发生变化必然影响另一个事物。

```memo
也可以理解为一个事物的存在或变化一定和另一个事情有关。没有A就没有B，B就依赖A而存存。
```

{% plantuml %}

Class A
Class B
A <.. B

{% endplantuml %}

#### 实现关系

接口与类之间的关系。

```memo
接口A在类B中进行实现。
```

{% plantuml %}

Class A
Class B
A<|..B

{% endplantuml %}

#### 关联关系

描述了一组链，链是对象之间的边接。

{% plantuml %}

Class A
Class B
A--B

{% endplantuml %}

##### 聚合关系

也可以叫聚集关系。集体与个体的关系，整体与部分的生命周期不同。

{% plantuml %}

Class A
Class B
A*--B

{% endplantuml %}

##### 组合关系

整体与部分的关系，其整体与部分的生命周期相同。

```memo
可理解为公司与部分，公司没了，公司的部分也不存在了。
即是说，没有整体也就没有个体了。
```

{% plantuml %}

Class A
Class B
A o--B

{% endplantuml %}

#### 泛化关系

接口与类之间的关系

```memo
由不同的个体提取出共同的部分，叫做泛化。
可理解为：猫、狗都是动物，动物就是猫和狗的泛化。
```

{% plantuml %}

Class A
Class B
Class C
A <|--B
A <|--C

{% endplantuml %}

```memo
实现与依赖的关系都属于不靠谱的关系，所以用虚线表示，而依赖的关系是必须的关系，所以用实心箭头，实现的关系属于可有可无，所以用空心箭头。

聚合关系中，可以理解为一个人聚合成了一群人，可以用实心菱形（人多，能填满所有空心的部分，就成了实心）。
组合关系中，各个部门组合成一个公司，数量上还是一，所以用空心菱形（数量少，填不满所有空心部分，还是空心。）。
泛化关系中，两个事物，提取出共公事件，在数量上还是一，所以用空心箭头。
```

#### 包含关系

两个或两个以上的用例提取公共行为，这个公共行为就是被包含的对象。

> 箭头指向的用例为被包含的用例。

```memo
到银行取钱或转账，其两个行为都必须登录，可以说取钱或转账都包含登录。没有登录的话，取钱和转账的操作就不能进行。
```

#### 扩展关系

混合了两种或两种以上的不同场景，根据情况可能发生多种分支。

> 箭头指向的用例为被扩展出来的用例。

```memo
至银行取钱的同时，也会发送短信到手机。发送短信这个行为就属于扩展。
```